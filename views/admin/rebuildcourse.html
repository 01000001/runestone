{{extend 'layout.html'}}


{{ if confirm: }}
  <h3>Rebuild your course</h3>

  <p>This will update your course with the latest changes to the content and layout.
    Are you sure you want to do this?
  </p>

  <form name="confirm" method="POST" action="/{{=request.application}}/admin/rebuildcourse">
   <input type="hidden" name="projectname" value="{{= auth.user.course_name}}" />
   <input type="checkbox" name="loginreq" value="yes" checked /> Require a username to access this course <br>
   <input type="submit" class="btn btn-small" value="Rebuild" />
  </form>

{{ else: }}
  <div id="spinner_div" class='pull-left' style="align: center;">
	  <img id="spinner" src="/{{=request.application}}/static/images/spinner10.gif" style="display: none;">
  </div>
  <p>Your course is being rebuilt.  This may take several minutes to complete. When the rebuild is finished, you will be
  redirected to your newly rebuilt course.</p>

  <script type="text/javascript">
    var iid = setInterval(function() {
      d = { task_name:'{{ =task_name }}',
            course_url:'{{ =course_url }}'};
      $.post(eBookConfig.ajaxURL+'getSphinxBuildStatus.json', d, function(data) {
        if (data.status == "true") {
          window.location.href = data.course_url;
        }
      });
    }, 3000);
  </script>